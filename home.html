<html>
    <head>
        <meta charset="utf-8">
        <title>Find a Seventh-day Adventist Church</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="Seventh-day Adventist Church locator using Google Maps. Mainly for South Africa." content="">
        <meta name="Kurt Campher, campherkurt2@gmail.com" content="">

        <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.css">
        <link rel="stylesheet" type="text/css" href="assets/css/map.css" />
        <link rel="stylesheet" type="text/css" href="assets/css/bootstrap-responsive.css">
        <link rel="stylesheet" type="text/css" href="assets/css/map.css" />
        
        
        
    </head>
    <body>
        <div class="navbar navbar-fixed-top" id="menu">
          <div class="navbar-inner">
            <div class="container">
              <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </a>
              <a class="brand" href="#">Find a SDA church?</a>
              <div class="nav-collapse">
                <ul class="nav">
                  <li class="active"><a href="#">Home</a></li>
                  <li><a href="#about">About</a></li>
                  <li><a href="#contact">Contact</a></li>
                </ul>
              </div><!--/.nav-collapse -->
            </div>
          </div>
        </div>
        <div id="example" >
            
        </div>
        
        <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
        <script src="assets/js/jquery.js"></script>
        <script type="text/javascript" src="assets/js/gmap3.js"></script>
        <script type="text/javascript" src="http://www.google.com/jsapi"></script>
        <script type="text/javascript" src="assets/js/infoBoxStyles.js"></script>
        <!-- Le javascript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="assets/js/bootstrap-transition.js"></script>
        <script src="assets/js/bootstrap-alert.js"></script>
        <script src="assets/js/bootstrap-modal.js"></script>
        <script src="assets/js/bootstrap-dropdown.js"></script>
        <script src="assets/js/bootstrap-scrollspy.js"></script>
        <script src="assets/js/bootstrap-tab.js"></script>
        <script src="assets/js/bootstrap-tooltip.js"></script>
        <script src="assets/js/bootstrap-popover.js"></script>
        <script src="assets/js/bootstrap-button.js"></script>
        <script src="assets/js/bootstrap-collapse.js"></script>
        <script src="assets/js/bootstrap-carousel.js"></script>
        <script src="assets/js/bootstrap-typeahead.js"></script>
        
        <script type="text/javascript">
            $(document).ready(function(){
                //GLOBALS
                var userPosition;
                var current_destination;
        //---------------- MAP Options-------------------------------------//
                function get_route() {
                    console.log("got it");
                };
                var styleArray = [
                    {
                      featureType: "all",
                      stylers: [
                        { saturation: -80 }
                      ]
                    },
                    {
                      featureType: "road.arterial",
                      elementType: "geometry",
                      stylers: [
                        { hue: "#00ffee" },
                        { saturation: 50 }
                      ]
                    },
                    {
                      featureType: "poi.business",
                      elementType: "labels",
                      stylers: [
                        { visibility: "off" }
                      ]
                    }
                  ];
                var zoomOptions = {
                    style: google.maps.ZoomControlStyle.SMALL,
                    position: google.maps.ControlPosition.LEFT_CENTER
                    };
                var myOptions = {
                  center: new google.maps.LatLng(-33.984123, 18.50895),
                  zoom: 12,
                  zoomControlOptions: zoomOptions,
                  streetViewControl: false,
                  panControl: false,
                  styles: styleArray,
                  mapTypeId: google.maps.MapTypeId.ROADMAP
                };
                var mapChurch = new google.maps.Map(document.getElementById("example"), myOptions);

                var directionsRenderOptions = {
                    suppressMarkers: true,
                    preserveViewport: true
                }
                var directionsRender = new google.maps.DirectionsRenderer(directionsRenderOptions);
                directionsRender.setMap(mapChurch);
        //--------------- END OF MAP OPTIONS--------------------------------//

        
                function getRoute() { 
                    if (userPosition)  {
                        var directionsOptions = {
                            origin: userPosition, 
                            destination: current_destination,
                            travelMode: google.maps.DirectionsTravelMode.DRIVING
                        };
                        var directionsService = new google.maps.DirectionsService();
                        directionsService.route(directionsOptions, function(response, status) {
                           if (status == google.maps.DirectionsStatus.OK) {
                                directionsRender.setDirections(response);
                            };
                        });
                    };
                }
    //------------ This Deals with the user's position----------------------------//
                function showPosition(position)
                    {
                        var userMarkerAnimation = google.maps.Animation.DROP;
                        var userMarkerImage =  new google.maps.MarkerImage("assets/img/down.png");
                        var userMarkerOptions = {
                            animation: userMarkerAnimation,
                            position: new google.maps.LatLng(position.coords.latitude, position.coords.longitude),
                            icon: userMarkerImage,
                            map: mapChurch,
                        };
                        userPosition = userMarkerOptions.position;
                        var userMarker = new google.maps.Marker(userMarkerOptions);
                        var userBoxText = '<div class="info_box"><div class="church_name info_details">You Are Here!!!</div><div class="church_details info_details"></div></div>';
                        var userInfoOptions = {
                            content: userBoxText
                           ,disableAutoPan: false
                           ,maxWidth: 0
                           ,pixelOffset: new google.maps.Size(0, -100)
                           ,zIndex: null
                           ,boxStyle: { opacity: 0.9 ,width: "280px"}
                           ,closeBoxMargin: ""
                           ,closeBoxURL: ""
                           ,infoBoxClearance: new google.maps.Size(1, 1)
                           ,isHidden: false
                           ,pane: "floatPane"
                           ,enableEventPropagation: true
                        };
                        var userInfoBox = new InfoBox(userInfoOptions);
                        
                        (function(marker){
                            google.maps.event.addListener(marker, "mouseover", function(e) {
                                userInfoBox.open(mapChurch, marker);
                            });
                            google.maps.event.addListener(marker, "mouseout", function(e) {
                                userInfoBox.close();
                            });
                        })(userMarker);
                    };

                    function positionError() {
                        switch(error.code) 
                            {
                                case error.TIMEOUT:
                                    alert ('Timeout');
                                    break;
                                case error.POSITION_UNAVAILABLE:
                                    alert ('Position unavailable');
                                    break;
                                case error.PERMISSION_DENIED:
                                    alert ('Permission denied');
                                    break;
                                case error.UNKNOWN_ERROR:
                                    alert ('Unknown error');
                                    break;
                            }
                    };
        //---------------------- Does the actual work to get the user position-------//
                    navigator.geolocation.getCurrentPosition(showPosition, function(error){
                        alert("got an error");
                        });
        //------------MARKER OPTIONS--------------------//
                var coordinateArray = [
                {coordinates: new google.maps.LatLng(-33.989976,18.501597), id: "lansdowne", title: "Lansdowne Church", address_details: "Cnr of Leafmore Rd and Kritzinger Rd<br/>Kenwyn<br/>Pastor: Dan Serb<br/>Head Elder: Nigel Tyhalibongo<br/>email: xtyhalibongo@uwc.ac.za"},
                {coordinates: new google.maps.LatLng(-34.02669,18.466301), id: "plumstead", title: "Plumstead Church", address_details: "242 Main Road<br/>Plumstead<br/>Pastor: Dan Serb<br/>Head Elder: Eric Bender<br/>email: redneb@telkomsa.net"},
                {coordinates: new google.maps.LatLng(-33.950358,18.470487), id: "mowbray", title: "Mowbray Church", address_details: "10 Bollihope Crescent<br/>Mowbray<br/>Pastor: Dan Serb<br/>Head Elder: Simon Hayes<br/>email: sdamb@xsinet.co.za"},
                {coordinates: new google.maps.LatLng(-34.010946,18.474093), id: "wynberg", title: "Wynberg Church", address_details: "10 Hertford Road<br/>Wynberg<br/>Pastor: Dan Serb<br/>Head Elder: R Langenhoven<br/>email: randall@wescape.co.za"},        
                {coordinates: new google.maps.LatLng(-33.982736,18.463622), id: "claremont", title: "Claremont Church", address_details: "21 Grove Avenue<br/>Claremont<br/>Pastor: Dan Serb<br/>Head Elder: A Adriaanse<br/>email: aa@whs.wcape.school.za"},
                {coordinates: new google.maps.LatLng(-34.139261,18.42968), id: "fish-hoek", title: "Fish Hoek Church", address_details: "Recreation Road<br/>Fish Hoek<br/>Pastor: Dan Serb<br/>Head Elder: Jonathan Edwards<br/>email: elder@fishhoeksda.co.za"},
                
                {coordinates: new google.maps.LatLng(-33.968575,18.508138), id: "athlone", title: "Athlone Church", address_details: "Buckley Road<br/>Gleemor<br/>Pastor: DG Harwood<br/>Head Elder: E Gibbons<br/>email: athlonesda@gmail.com"},
                {coordinates: new google.maps.LatLng(-33.965299,18.52082), id: "riverside", title: "Riverside Church", address_details: "Klipfontein Road<br/>Athlone<br/>Pastor: DG Harwood<br/>Head Elder: L Truter"},
                
                //{coordinates: new google.maps.LatLng(-33.975041,18.514021), id: "retreat", title: "Retreat Church", address_details: "18 Eleventh Road<br/>Heathfield<br/>Pastor: JE Tumpkin<br/>Head Elder: Austin Rodney <br/> email: arodney@pgwc.gov.za"},
                {coordinates: new google.maps.LatLng(-34.077916,18.478083), id: "steenberg", title: "Steenberg Church", address_details: "52 Coniston Avenue, Coniston Park<br/>Steenberg<br/>Pastor: JE Tumpkin<br/>Head Elder: R Stevens<br/> email: Richards@rensa.co.za"},
                //{coordinates: new google.maps.LatLng(-33.975041,18.514021), id: "ocean-view", title: "Ocean View Church", address_details: "7 Bootes Close<br/>Ocean View <br/>Pastor: JE Tumpkin<br/>Head Elder: D De Bruin"},
                //{coordinates: new google.maps.LatLng(-33.975041,18.514021), id: "grassy-park", title: "Grassy Park Church", address_details: "Perth Road<br/>Grassy Park<br/>Pastor: JE Tumpkin<br/>Head Elder: AB Daniels <br/> email: arthur.daniels@capetown.gov.za"},
                ];
                var markerImage = new google.maps.MarkerImage("assets/img/conference.png");
                var markerAnimation = google.maps.Animation.DROP

        //------------SUPER STYLED INFO BOX-------------//
                var infoOptions = {
                        content: 'holding...'
                       ,disableAutoPan: false
                       ,maxWidth: 0
                       ,pixelOffset: new google.maps.Size(15, -170)
                       ,zIndex: null
                       ,boxStyle: { opacity: 0.9 ,width: "280px"}
                       ,closeBoxMargin: "2px -38px 8px 2px"
                       ,closeBoxURL: "http://www.google.com/intl/en_us/mapfiles/close.gif"
                       ,infoBoxClearance: new google.maps.Size(1, 1)
                       ,isHidden: false
                       ,pane: "floatPane"
                       ,enableEventPropagation: false
                    };
                var ib = new InfoBox(infoOptions);
                for(var i in coordinateArray ) {
                    var id = coordinateArray[i]['id'];
                    var title = coordinateArray[i]['title'];
                    var position = coordinateArray[i]['coordinates'];
                    var address_details = coordinateArray[i]['address_details'];

                    var boxText = [
                                '<div class="info_box">',
                                    '<div class="church_name info_details">' + title + '</div>',
                                    '<div class="church_details info_details">' + address_details + '</div>',
                                    '<div class="info_details button_box">',
                                        '<input type="hidden" id="' + id + '_lat_"' + position.lat() + '></input>',
                                        '<input type="hidden" id="' + id + '_long_"' + position.lng() + '></input>',
                                        '<a href="#" id="' + id + '" class="btn find_route_button">Find a Route</a>',
                                    '</div>',
                                '</div>'
                                ].join(" ");

                    var markerOptions = {
                        animation: markerAnimation,
                        position: coordinateArray[i]['coordinates'],
                        icon: markerImage,
                        map: mapChurch,
                        html: boxText,
                        id: id
                    };

                    var newMarker = new google.maps.Marker(markerOptions);

        //-------------- Creating a closure to retain the correct markerInfoOptions -------------------//
                    (function(marker) {
                        // Attaching a mouseover event to the current marker
                        google.maps.event.addListener(marker, "click", function(e) {
                            ib.setContent(marker.html); 
                            ib.open(mapChurch, marker);
                        });
                        
                    })(newMarker);
                    
                    (function(infoBoxObject, markerObject) {
                                google.maps.event.addListener(infoBoxObject, "domready", function() {
                                    $("#" + markerObject.id).click(function(){
                                        current_destination = markerObject.getPosition()
                                        if (userPosition != null){
                                            getRoute()
                                        }
                                        else {
                                            alert("Sorry but we need your location to plot a route, and your device cannot currently provide it");
                                        };
                                    })
                                });
                    }(ib, newMarker));
                }
        });
        </script>
    </body>
    
</html>